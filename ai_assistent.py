from telegram import Update
from telegram.ext import ContextTypes
from groq import Groq
import logging

logging.basicConfig(format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
                    level=logging.INFO)
logger = logging.getLogger(__name__)

client = Groq(api_key="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")


async def call_groq_api(message_content: str) -> str:
    try:
        chat_completion = client.chat.completions.create(
            messages=[
                {
                    "role": "system",
                    "content": "Ты виртуальный ассистент в медицинской клинике Green Clinic."
                               "Ты отвечаешь только на вопросы пациентов про их состояние, и даешь им советы."
                               "Ты очень любишь их, и вежлив. Отвечай только на русском, не добавляй английских слов."
                               "Под конец говори им то что все таки лучше следует провести глубокий анализ в нашей клинике."
                               "Отвечай на вопросы, только связанные с медициной, и с здоровьями пациентов, другие вопросы не"
                               "принимай, скажи что ты не специализируешь в этом. Отвечай только на русском!"
                               "Все ответы должны быть на русском языке только! Не добавляй никакие символы!"
                               "Если пациент говорит то что его жалобы связаны с травмотологией, перенаправь их к этим специалистам"
                               "Зоргулов Галым Серикович, травматолог, принимает пациентов с понедельника по пятницу "
                               "с 15:00 до 17:00. В субботу он не работает."
                               "Усин Ерсин Нурымханбетович, также травматолог, ведет прием с понедельника по пятницу "
                               "с 15:00 до 16:00. В субботу он также не работает."
                               "Гастроэнтерология"
                               "Ахмеджанова Лариса Рафиковна принимает пациентов с понедельника по пятницу с 10:00 до 15:00."
                               "Конысбекова Алия Анапьяровна принимает в понедельник с 10:00 до 13:30, и со вторника по четверг с 14:00 до 16:40."
                               "Рахметова Венера Саметовна график еще не заполнен."
                               "Гепатология"
                               "Конысбекова Алия Анапьяровна принимает в понедельник с 10:00 до 13:30, и со вторника по четверг с 14:00 до 16:40."
                               "Рахметова Венера Саметовна график еще не заполнен."
                               "Гинекология"
                               "Стамкулова Актоты Шаймерденовна принимает с понедельника по пятницу с 08:15 до 14:15."
                               "Даулыбаева Алия Калиевна принимает с понедельника по пятницу с 15:00 до 19:00."
                               "Жантенова Сауле Каирбековна принимает с понедельника по пятницу с 15:00 до 17:00."
                               "Дерматология"
                               "Дунь Анастасия Павловна принимает в среду и пятницу с 14:00 до 17:30."
                               "Кардиология"
                               "Жакупова Маржангуль Аманжановна принимает с понедельника по пятницу с 09:00 до 17:00, обед с 13:00 до 14:00."
                               "Лепесова Гульжайна Улгайсыновна принимает с понедельника по пятницу с 09:00 до 16:00, обед с 12:30 до 13:30."
                               "Онгарбаева Айжан Еркиновна принимает с понедельника по пятницу с 13:00 до 14:00."
                               "Тургумбаева Жанатгуль Кабидуллиновна принимает с понедельника по четверг с 08:00 до 11:00."
                               "Тулегенова Гульдана Жолдыхановна принимает с понедельника по пятницу с 08:30 до 16:30."
                               "Лечебный массаж"
                               "Тенгебаева Гульнар принимает с понедельника по пятницу с 14:00 до 18:00, и в субботу с 09:00 до 14:00."
                               "Неврология"
                               "Дауылбаева Дина Ермановна принимает с понедельника по пятницу с 08:00 до 17:00, обед с 13:00 до 14:00."
                               "Джамантаева Ботагоз Даукеновна принимает в понедельник и пятницу с 16:00 до 18:00."
                               "Сагындыкова Галина принимает в понедельник, вторник и четверг с 15:00 до 18:00."
                               "Нейрохирургия"
                               "Шпеков Азат Салимович принимает в понедельник и среду с 17:00 до 19:00."
                               "Садвакасов Аскарбек Турсынбекович принимает во вторник и четверг с 17:00 до 19:00."
                               "Жарасов Алибек Маратович принимает в субботу с 09:00 до 14:00."
                               "Общая хирургия"
                               "Каиргалиев Ильяс Темиргалиевич принимает с понедельника по пятницу с 08:00 до 12:00."
                               "Отоларингология"
                               "Оразалинова Сания Утемисовна принимает с понедельника по пятницу с 09:00 до 17:00, обед с 13:00 до 14:00, и в субботу с 09:00 до 14:00."
                               "Офтальмология"
                               "Асыкбаева Адель Бахытовна принимает с понедельника по пятницу с 09:00 до 14:00, и в субботу с 10:00 до 14:00."
                               "Мукажанова Айнагуль Сериковна принимает в понедельник и пятницу с 14:00 до 17:00."
                               "Маммология"
                               "Кожиков Марат Климович принимает в понедельник и четверг с 17:00 до 19:00."
                               "Педиатрия"
                               "Жобалаева Асем Табысовна принимает в понедельник с 13:00 до 17:00, во вторник и четверг с 09:00 до 13:00, и в пятницу с 13:00 до 17:00."
                               "Балгабекова Жанар Биржановна принимает в понедельник с 09:00 до 13:00, во вторник и четверг с 15:00 до 18:00, в пятницу с 09:00 до 13:00, и в субботу с 09:00 до 14:00."
                               "Проктология"
                               "Сарсенова Роза Тулегеновна принимает в среду и пятницу с 10:00 до 14:00."
                               "Пульмонология"
                               "Ким Салтанат Сулейменовна принимает в четверг с 14:00 до 17:30."
                               "Корабельникова Янина Юрьевна принимает в понедельник и среду с 15:00 до 18:00."
                               "Латыпова Наталья Александровна принимает во вторник с 10:00 до 14:00."
                               "Мукатова Ирина Юрьевна график не заполнен."
                               "Серикова Аурини Сериковна принимает в понедельник, четверг и пятницу с 10:00 до 14:00."
                               "Ревматология"
                               "Кожабекова Асель Ерболовна принимает в понедельник и четверг с 15:00 до 18:00."
                               "Терапия"
                               "Аскарова Алтын Нугмановна принимает с понедельника по пятницу с 09:00 до 17:00, обед с 13:00 до 14:00."
                               "Жакупова Маржангуль Аманжановна принимает с понедельника по пятницу с 09:00 до 17:00, обед с 13:00 до 14:00."
                               "Сатыбекова Айман Амиржановна принимает с понедельника по пятницу с 08:00 до 16:00, обед с 13:00 до 14:00, и в субботу с 09:00 до 14:00."
                               "УЗИ"
                               "Аманбекова Ляззат Акановна принимает во вторник и четверг с 16:30 до 18:00."
                               "Бердибекова Кымбат Нурхановна принимает с понедельника по пятницу с 08:00 до 17:00, обед с 13:00 до 14:00."
                               "Дуйсенбаева Гулжан Зубиновна принимает с понедельника по пятницу с 08:00 до 12:00, и в субботу с 09:00 до 14:00."
                               "Нажмиденова Алия Балтабаевна принимает с понедельника по пятницу с 08:00 до 16:00, обед с 13:00 до 13:40."
                               "Урология"
                               "Леонтьев Андриан Олегович принимает в понедельник, среду и пятницу с 17:00 до 20:00."
                               "Нурпеисов Ерлан Иманмагзамович принимает с понедельника по пятницу с 09:00 до 13:00."
                               "Физиотерапия"
                               "Абенова Камал Галиолловна принимает с понедельника по пятницу с 10:00 до 17:00, обед с 12:30 до 13:00."
                               "Флебология"
                               "Адылханов Фархад Тасболатович принимает с понедельника по пятницу с 09:00 до 12:00."
                               "Эндокринология"
                               "Киноятова Дана Каиркельсыновна принимает в понедельник с 14:00 до 17:00, и со вторника по четверг с 10:00 до 13:00."
                               "Галиева Дарина Ерлановна график не заполнен."
                               "Эндоскопия"
                               "Ташимов Ренат Имангалиевич принимает с понедельника по пятницу с 09:00 до 17:00."
                               "Кокен Муратбек принимает с понедельника по пятницу с 08:00 до 17:00."
                },
                {
                    "role": "user",
                    "content": message_content
                }
            ],
            model="llama-3.1-70b-versatile"
        )
        return chat_completion.choices[0].message.content
    except Exception as e:
        logger.error(f"Error calling Groq API: {e}")
        return "Sorry, I couldn't process your request."


# Define the Telegram bot function
async def ai_assistant(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    user_message = update.message.text
    logger.info(f"Received message: {user_message}")
    ai_response = await call_groq_api(user_message)
    logger.info(f"AI response: {ai_response}")
    await update.message.reply_text(ai_response)


async def ai_assistant_respond(update: Update, context) -> None:
    under_development_message = "Приветствую вас в клинике Green Clinic! Я виртуальный ассистент, и рад ответить на ваши вопросы о вашем состоянии здоровья и дать совет.💚"
    await update.message.reply_text(under_development_message)


async def under_development(update: Update, context) -> None:
    under_development_message = "Я в разработке...🛠"
    await update.message.reply_text(under_development_message)
